// database.js - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
const sqlite3 = require('sqlite3').verbose();
const path = require('path');
const fs = require('fs');

// –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
const dbDir = path.join(__dirname, 'db');
if (!fs.existsSync(dbDir)) {
  fs.mkdirSync(dbDir);
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
const db = new sqlite3.Database(path.join(dbDir, 'kit_admissions.db'));

// –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
function initDatabase() {
  return new Promise((resolve, reject) => {
    // –í—ã–ø–æ–ª–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü
    db.serialize(() => {
      // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π
      
      
      db.run(`CREATE TABLE IF NOT EXISTS specialties (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        code TEXT NOT NULL,
        name TEXT NOT NULL,
        duration TEXT NOT NULL, 
        qualification TEXT NOT NULL,
        description TEXT NOT NULL,
        advantages TEXT NOT NULL,
        image_url TEXT,
        plan_url TEXT
      )`);

      // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
      db.run(`CREATE TABLE IF NOT EXISTS documents (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        file_url TEXT,
        category TEXT NOT NULL
      )`);

      // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤
      db.run(`CREATE TABLE IF NOT EXISTS applicants (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        full_name TEXT NOT NULL,
        specialty_id INTEGER NOT NULL,
        points REAL NOT NULL,
        status TEXT DEFAULT '–û–∂–∏–¥–∞–Ω–∏–µ',
        FOREIGN KEY(specialty_id) REFERENCES specialties(id)
      )`);

      // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ª–∏–º–∏—Ç–æ–≤ –±—é–¥–∂–µ—Ç–Ω—ã—Ö –º–µ—Å—Ç
      db.run(`CREATE TABLE IF NOT EXISTS budget_limits (
        specialty_id INTEGER PRIMARY KEY,
        budget_limit INTEGER NOT NULL,
        FOREIGN KEY(specialty_id) REFERENCES specialties(id)
      )`);

      // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–∫
      db.run(`CREATE TABLE IF NOT EXISTS settings (
        key TEXT PRIMARY KEY,
        value TEXT NOT NULL
      )`);

      // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ "–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ –≤ –ö–ò–¢"
      db.run(`CREATE TABLE IF NOT EXISTS gallery (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        title TEXT NOT NULL,
        image_url TEXT NOT NULL,
        type TEXT DEFAULT 'image'
      )`);
        // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∑–∞—è–≤–æ–∫
      db.run(`CREATE TABLE IF NOT EXISTS applications (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        user_id TEXT NOT NULL,
        specialty_id INTEGER NOT NULL,
        full_name TEXT NOT NULL,
        phone TEXT NOT NULL,
        status TEXT DEFAULT '–ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏',
        created_at TEXT DEFAULT CURRENT_TIMESTAMP,
        FOREIGN KEY(specialty_id) REFERENCES specialties(id)
      )`);
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ specialties
      db.get(`SELECT COUNT(*) as count FROM specialties`, [], (err, row) => {
        if (err) {
          reject(err);
          return;
        }

        // –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        if (row.count === 0) {
          insertInitialData()
            .then(resolve)
            .catch(reject);
        } else {
          resolve();
        }
        
      });
    });
  });
}

// –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
function insertInitialData() {
  return new Promise((resolve, reject) => {
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
    const specialties = [
      {
        code: '09.02.06',
        name: '–°–µ—Ç–µ–≤–æ–µ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ',
        duration: '3 –≥–æ–¥–∞ 10 –º–µ—Å—è—Ü–µ–≤',
        qualification: '–°–µ—Ç–µ–≤–æ–π –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä; —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—é —Å–µ—Ç–∏',
        description: '–°–µ—Ç–µ–≤–æ–π –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä; —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—é —Å–µ—Ç–∏ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏, —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Å–µ—Ç–µ–≤—ã—Ö –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ —Å–µ—Ç–µ–≤–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è, –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–¥–∞—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.',
        advantages: '–í—Ö–æ–¥–∏—Ç –≤ –¢–û–ü-50 –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π; –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∏–∫–∞ —Ä–∞–±–æ—Ç—ã; –í–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –Ω–∞ —Ä—ã–Ω–∫–µ —Ç—Ä—É–¥–∞; –í—ã—Å–æ–∫–∞—è –∑–∞—Ä–∞–±–æ—Ç–Ω–∞—è –ø–ª–∞—Ç–∞; –ö–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç.'
      },
      {
        code: '09.02.07',
        name: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ',
        duration: '3 –≥–æ–¥–∞ 10 –º–µ—Å—è—Ü–µ–≤',
        qualification: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å, —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è',
        description: '–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–∏—Å–∞—Ç–µ–ª—å, —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–æ–π –º–æ–¥—É–ª–µ–π –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –¥–ª—è –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º, –æ—Å—É—â–µ—Å—Ç–≤–ª–µ–Ω–∏–µ–º –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã—Ö –º–æ–¥—É–ª–µ–π, –Ω–∞–ø–∏—Å–∞–Ω–∏–µ–º —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º.',
        advantages: '–í–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –Ω–∞ —Ä—ã–Ω–∫–µ —Ç—Ä—É–¥–∞; –í—ã—Å–æ–∫–∞—è –∑–∞—Ä–∞–±–æ—Ç–Ω–∞—è –ø–ª–∞—Ç–∞; –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã (—Ñ—Ä–∏–ª–∞–Ω—Å); –ö–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç; –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã.'
      },
      {
        code: '11.02.15',
        name: '–ò–Ω—Ñ–æ–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏ –∏ —Å–∏—Å—Ç–µ–º—ã —Å–≤—è–∑–∏',
        duration: '3 –≥–æ–¥–∞ 10 –º–µ—Å—è—Ü–µ–≤',
        qualification: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –º–æ–Ω—Ç–∞–∂—É –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é —Ç–µ–ª–µ–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π',
        description: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –º–æ–Ω—Ç–∞–∂—É –∏ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—é —Ç–µ–ª–µ–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º –∏ —Å–µ—Ç–µ–π —Å–≤—è–∑–∏, –º–æ–Ω—Ç–∞–∂–æ–º –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è —Å–≤—è–∑–∏, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É—Å–ª—É–≥ —Å–≤—è–∑–∏.',
        advantages: '–í—Ö–æ–¥–∏—Ç –≤ –¢–û–ü-50 –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π; –®–∏—Ä–æ–∫–∏–π –ø—Ä–æ—Ñ–∏–ª—å —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏; –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ –∑–Ω–∞–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏; –í—ã—Å–æ–∫–∞—è –∑–∞—Ä–∞–±–æ—Ç–Ω–∞—è –ø–ª–∞—Ç–∞; –ö–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç; –°—Ç–∞–±–∏–ª—å–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã.'
      },
      {
        code: '42.02.01',
        name: '–†–µ–∫–ª–∞–º–∞',
        duration: '3 –≥–æ–¥–∞ 10 –º–µ—Å—è—Ü–µ–≤',
        qualification: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Ä–µ–∫–ª–∞–º–µ',
        description: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —Ä–µ–∫–ª–∞–º–µ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é, –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞, —Å–æ–∑–¥–∞–Ω–∏–µ–º –¥–∏–∑–∞–π–Ω–∞ —Ä–µ–∫–ª–∞–º–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ–æ—Ç–æ –∏ –≤–∏–¥–µ–æ.',
        advantages: '–£—á–∞—Å—Ç–∏–µ –≤–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π; –û–±—â–µ–Ω–∏–µ —Å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º–∏ –ª—é–¥—å–º–∏; –°—Ç—Ä–µ–º–∏—Ç–µ–ª—å–Ω—ã–π –∫–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç; –ì–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã; –ù–æ–≤–∏–∑–Ω–∞.'
      },
      {
        code: '11.02.12',
        name: '–ü–æ—á—Ç–æ–≤–∞—è —Å–≤—è–∑—å',
        duration: '2 –≥–æ–¥–∞ 10 –º–µ—Å—è—Ü–µ–≤',
        qualification: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ—á—Ç–æ–≤–æ–π —Å–≤—è–∑–∏',
        description: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ—á—Ç–æ–≤–æ–π —Å–≤—è–∑–∏ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π —Ä–∞–±–æ—Ç –ø–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—é —É—Å–ª—É–≥ –ø–æ—á—Ç–æ–≤–æ–π —Å–≤—è–∑–∏. –†–µ—à–∞–µ—Ç –∑–∞–¥–∞—á–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ —É—Å–ª—É–≥ –ø–æ—á—Ç–æ–≤–æ–π —Å–≤—è–∑–∏ –∏ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç –∏—Ö —Ç–µ—Ö–Ω–∏—á–µ—Å–∫—É—é —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é.',
        advantages: '–†–∞–∑–≤–∏—Ç–∞—è –∫–æ–º–º—É–Ω–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞; –°—Ç—Ä–µ–º–∏—Ç–µ–ª—å–Ω—ã–π –∫–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç; –ì–∏–±–∫–∏–π –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã; –í–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–æ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –Ω–∞ –ø—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–∏; –°–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–æ —Å —Å–æ—Ü–∏–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏; –ò–Ω–Ω–æ–≤–∞—Ü–∏–∏.'
      },
      {
        code: '10.02.05',
        name: '–û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º',
        duration: '3 –≥–æ–¥–∞ 10 –º–µ—Å—è—Ü–µ–≤',
        qualification: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏',
        description: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –∑–∞—â–∏—Ç–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö, –≤—ã—è–≤–ª–µ–Ω–∏–µ–º –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ–º —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π, –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞—â–∏—Ç—ã –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.',
        advantages: '–í—Ö–æ–¥–∏—Ç –≤ –¢–û–ü-50 –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω—ã—Ö —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π; –í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –∑–∞—Ä–∞–±–æ—Ç–Ω–æ–π –ø–ª–∞—Ç—ã; –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏; –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã –≤ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ö; –í—ã—Å–æ–∫–∞—è –≤–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –Ω–∞ —Ä—ã–Ω–∫–µ —Ç—Ä—É–¥–∞.'
      },
      {
        code: '11.02.16',
        name: '–ú–æ–Ω—Ç–∞–∂, —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ –∏ —Ä–µ–º–æ–Ω—Ç —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –ø—Ä–∏–±–æ—Ä–æ–≤',
        duration: '3 –≥–æ–¥–∞ 10 –º–µ—Å—è—Ü–µ–≤',
        qualification: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç –ø–æ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã–º –ø—Ä–∏–±–æ—Ä–∞–º –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º',
        description: '–í—ã–ø—É—Å–∫–Ω–∏–∫ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –æ–±–ª–∞—Å—Ç—è—Ö: –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ —ç–ª–µ–∫—Ç—Ä–æ–æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è, —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–≥–æ –∏ –æ–ø—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è; –°–∫–≤–æ–∑–Ω—ã–µ –≤–∏–¥—ã –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω–æ—Å—Ç–∏.',
        advantages: '–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–±–æ—Ä–∫–∏, –º–æ–Ω—Ç–∞–∂–∞ –∏ –¥–µ–º–æ–Ω—Ç–∞–∂–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –ø—Ä–∏–±–æ—Ä–æ–≤ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤; –ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∏ —Ä–µ–º–æ–Ω—Ç–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –ø—Ä–∏–±–æ—Ä–æ–≤ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤; –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –ø—Ä–∏–±–æ—Ä–æ–≤ –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–µ—á–∞—Ç–Ω–æ–≥–æ –º–æ–Ω—Ç–∞–∂–∞.'
      },
      {
        code: '54.02.01',
        name: '–î–∏–∑–∞–π–Ω (–ø–æ –æ—Ç—Ä–∞—Å–ª—è–º)',
        duration: '2 –≥–æ–¥–∞ 10 –º–µ—Å—è—Ü–µ–≤ –∏ 3 –≥–æ–¥–∞ 10 –º–µ—Å—è—Ü–µ–≤',
        qualification: '–î–∏–∑–∞–π–Ω–µ—Ä',
        description: '–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∏–¥–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ –ø–æ –¥–∏–∑–∞–π–Ω—É –≤—ã–¥–µ–ª—è—é—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ—Ç—Ä–∞—Å–ª–µ–π –¥–∞–Ω–Ω–æ–π –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏: –ø—Ä–æ–º—ã—à–ª–µ–Ω–Ω—ã–π (–æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –±—ã—Ç–æ–≤–æ–π —Ç–µ—Ö–Ω–∏–∫–∏, —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞, –æ—Ä—É–¥–∏–π —Ç—Ä—É–¥–∞, –º–µ–±–µ–ª–∏); –¥–∏–∑–∞–π–Ω —Å—Ä–µ–¥—ã (—Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–≤, –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–¥–∞–Ω–∏–π, —É—á–∞—Å—Ç–∫–æ–≤); –¥–∏–∑–∞–π–Ω –æ–¥–µ–∂–¥—ã.',
        advantages: '–¢–≤–æ—Ä—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è; –®–∏—Ä–æ–∫–∞—è —Å—Ñ–µ—Ä–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–∞–≤—ã–∫–æ–≤; –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Ñ—Ä–∏–ª–∞–Ω—Å–µ—Ä–æ–º; –í–æ—Å—Ç—Ä–µ–±–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –Ω–∞ —Ä—ã–Ω–∫–µ —Ç—Ä—É–¥–∞; –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏.'
      }
    ];

    // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–∏–µ–º–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–∏
    const admissionDocuments = [
      { name: '–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–µ–º–∞ –æ–±—É—á–∞—é—â–∏—Ö—Å—è –Ω–∞ 2025/26 —É—á–µ–±–Ω—ã–π –≥–æ–¥', category: 'admission' },
      { name: '–û–±—Ä–∞–∑–µ—Ü –¥–æ–≥–æ–≤–æ—Ä–∞ –æ–± –æ–∫–∞–∑–∞–Ω–∏–∏ –ø–ª–∞—Ç–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª—É–≥', category: 'admission' },
      { name: '–ü–µ—Ä–µ—á–µ–Ω—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π', category: 'admission' },
      { name: '–ü–∞–º—è—Ç–∫–∞ –æ –ø—Ä–∏–µ–º–µ —Å–∏—Ä–æ—Ç (–≤ —Ç–æ–º —á–∏—Å–ª–µ –ø–æ–¥ –ø–æ–ø–µ—á–∏—Ç–µ–ª—å—Å—Ç–≤–æ–º)', category: 'admission' },
      { name: '–ü–æ–ª–æ–∂–µ–Ω–∏–µ –æ –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏—è—Ö –≤ –û–ë–ü–û–£ "–ö–ò–¢"', category: 'admission' },
      { name: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–æ—Ä–º–∞—Ö –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π –∏ —Ñ–æ—Ä–º–∞—Ö –∏—Ö –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è', category: 'admission' },
      { name: '–ü—Ä–∞–≤–∏–ª–∞ –ø–æ–¥–∞—á–∏ –∏ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏—è –∞–ø–µ–ª–ª—è—Ü–∏–π –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –≤—Å—Ç—É–ø–∏—Ç–µ–ª—å–Ω—ã—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π', category: 'admission' },
      { name: '–ü—Ä–∏–∫–∞–∑ –æ–± —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–±—É—á–µ–Ω–∏—è –Ω–∞ 2025/2026 —É—á–µ–±–Ω—ã–π –≥–æ–¥', category: 'admission' },
      { name: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—â–µ–∂–∏—Ç–∏–∏', category: 'admission' },
      { name: '–°–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã 086', category: 'admission' },
      { name: '–ú–µ–¥.–∑–∞–∫–ª—é—á–µ–Ω–∏–µ –æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–∏ –∫ –º–µ–¥.–≥—Ä—É–ø–ø–µ –§–ó', category: 'admission' }
    ];

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–µ–º–Ω–æ–π –∫–æ–º–∏—Å—Å–∏–∏
    const settings = [
      { key: 'admission_schedule', value: '–ü–ù - –ü–¢ —Å 09:00 –¥–æ 17:00\n–°–ë - —Å 09:00 –¥–æ 13:00' },
      { key: 'admission_address', value: '—É–ª. –°. –ü–µ—Ä–æ–≤—Å–∫–æ–π, 16. 2 —ç—Ç–∞–∂, –∞—É–¥. 22' },
      { key: 'admission_phone', value: '(471) 254-09-32' },
      { key: 'admission_email', value: 'zavuch@kts46.ru' },
      { key: 'admission_responsible', value: '–ê–≤–¥–µ–µ–≤–∞ –ú–∞—Ä–∏—è –í–∞–ª–µ—Ä—å–µ–≤–Ω–∞, –∑–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∞ –ø–æ –£–†' },
      { key: 'welcome_message', value: 'üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç-–±–æ—Ç –ê–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–∞ –û–ë–ü–û–£ "–ö–ò–¢"! –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ —É–∑–Ω–∞—Ç—å –æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—è—Ö –∫–æ–ª–ª–µ–¥–∂–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö –¥–ª—è –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥ –≤ —Å–ø–∏—Å–∫–µ –ø–æ—Å—Ç—É–ø–∞—é—â–∏—Ö –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ. –í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–π –≤–∞—Å —Ä–∞–∑–¥–µ–ª –≤ –º–µ–Ω—é.' }
    ];

    // –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏
    const gallery = [
      { title: '–ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å –ö–ò–¢', image_url: 'https://example.com/gallery/building.jpg', type: 'image' },
      { title: '–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è', image_url: 'https://example.com/gallery/lab.jpg', type: 'image' },
      { title: '–°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∞—è –∂–∏–∑–Ω—å', image_url: 'https://example.com/gallery/students.jpg', type: 'image' }
    ];

    // –ù–∞–ø–æ–ª–Ω—è–µ–º –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞—á–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    db.serialize(() => {
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
      const stmt1 = db.prepare(`INSERT INTO specialties 
        (code, name, duration, qualification, description, advantages, image_url, plan_url) 
        VALUES (?, ?, ?, ?, ?, ?, ?, ?)`);
      
      specialties.forEach(specialty => {
        stmt1.run(
          specialty.code, 
          specialty.name, 
          specialty.duration, 
          specialty.qualification, 
          specialty.description, 
          specialty.advantages,
          null,  // image_url
          null   // plan_url
        );
      });
      stmt1.finalize();

      // –î–æ–±–∞–≤–ª—è–µ–º –¥–æ–∫—É–º–µ–Ω—Ç—ã
      const stmt2 = db.prepare(`INSERT INTO documents (name, category) VALUES (?, ?)`);
      admissionDocuments.forEach(doc => {
        stmt2.run(doc.name, doc.category);
      });
      stmt2.finalize();

      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
      const stmt3 = db.prepare(`INSERT INTO settings (key, value) VALUES (?, ?)`);
      settings.forEach(setting => {
        stmt3.run(setting.key, setting.value);
      });
      stmt3.finalize();

      // –î–æ–±–∞–≤–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≥–∞–ª–µ—Ä–µ–∏
      const stmt4 = db.prepare(`INSERT INTO gallery (title, image_url, type) VALUES (?, ?, ?)`);
      gallery.forEach(item => {
        stmt4.run(item.title, item.image_url, item.type);
      });
      stmt4.finalize();

      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª–∏–º–∏—Ç—ã –±—é–¥–∂–µ—Ç–Ω—ã—Ö –º–µ—Å—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      db.get(`SELECT COUNT(*) as count FROM budget_limits`, [], (err, row) => {
        if (err || row.count > 0) return;
        
        db.all(`SELECT id FROM specialties`, [], (err, rows) => {
          if (err) {
            reject(err);
            return;
          }
          
          const stmt5 = db.prepare(`INSERT INTO budget_limits (specialty_id, budget_limit) VALUES (?, ?)`);
          rows.forEach(row => {
            stmt5.run(row.id, 25); // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 25 –±—é–¥–∂–µ—Ç–Ω—ã—Ö –º–µ—Å—Ç
          });
          stmt5.finalize();
          
          resolve();
        });
      });
    });
  });
}

// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –æ–±—ä–µ–∫—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
module.exports = {
  db,
  initDatabase
};